language: rust

services:
  - docker

git:
  depth: 1

os:
  - linux
  - osx
  - windows

rust:
  - stable
  - beta
  - nightly

matrix:
  fast_finish: true
  include:
    - if: tag IS present
      os: linux
      rust: stable
      env: ARCH=i386
    - name: "Clippy Linux"
      os: linux
      env: CLIPPY=true
      rust: stable
    - name: "Clippy OSX"
      os: osx
      env: CLIPPY=true
      rust: stable
    - name: "Clippy Windows"
      os: windows
      env: CLIPPY=true
      rust: stable
  allow_failures:
    - rust: nightly

install: ci/install.sh
script: ci/script.sh
before_deploy: ci/before_deploy.sh

deploy:
  provider: releases
  api_key:
    secure: mD3sjpfHXGW5F8Xeslsl7PysKMK68tt7VuflxmYW4xs4QYo7WM6FMlIlVDNSvnUrzVtsiUi/BhMMhPruTnmeKDNRU+S0v/sT0eUGWvg74X0Q/oIgkgYMbEw08lMR560YPJ+E2MeZ2o02ERR32jWxnntnOZ0a+OdnRL1sYyHjtyMwJoxUIAX0Lh3DXjW6eApbymgA05rz1macE64DmveVdGgyrzTJanKxXoMmU7LVORreHzvHkXkgnXG0Wh4DEy3lEkCDLyS/qI06aRuBZ7ojaNjsGclegWwzA2GL1jNmOhibBeiIT/lpVLIMG6O4ZbAwOF0a2Rf7tRf6GpvLR3SVEUY48i0/VJCJM+LwN793VaU5G1IpxkMEqcmDl8UfMqzvqRMW3AXae0VQNoKVakabd0fZZP2lmC0eGjNP35arclS5JLMdz2vhBMRTr/dpoP8BDvOHqPaLYU46EzKPaaaHyLImy8j9Ca+THK+e9poiq25FGTgJUF6Ncv8CDEOtA93g7ST9SVrrfDHxmpMkOHKNFi620YeIzY7uj71WbUhWljCgPwWBrUF4hcUW48Hb87sV8o9KZkSWCgeJ3qR1PQXwJJoK7KZ4r7wB1EvKq4r/xI7DZdSQwOd1YmpZKj/4E0UoS8BSZD7gA6m76XcvOqpCmDo7CQxdakBtWtpCpok8w/E=
  skip_cleanup: true
  file_glob: true
  file: "./target/deploy/*"
  on:
    tags: true
    rust: stable
    condition: $CLIPPY != true
    branch: master
